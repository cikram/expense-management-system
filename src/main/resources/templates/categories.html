<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Mes Catégories</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --blue-main: #2563eb;
            --blue-dark: #1e40af;
            --blue-deep: #111827;
            --glass-border: rgba(37, 99, 235, 0.18);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background:
                radial-gradient(circle at 15% 20%, rgba(37,99,235,0.06), transparent 50%),
                radial-gradient(circle at 85% 80%, rgba(59,130,246,0.05), transparent 50%),
                linear-gradient(135deg, #f8fafc, #eff6ff, #dbeafe);
            color: #1e293b;
            min-height: 100vh;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 35px;
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.95), rgba(239, 246, 255, 0.95));
            backdrop-filter: blur(16px);
            border-bottom: 1px solid var(--glass-border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--blue-deep) 0%, var(--blue-dark) 50%, var(--blue-main) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        nav {
            display: flex;
            gap: 28px;
            align-items: center;
        }

        nav a {
            color: #475569;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s ease;
        }

        nav a:hover { color: var(--blue-dark); }


        .profile-menu { position: relative; display: flex; align-items: center; }
        .profile-button {
            background: none;
            color: #475569;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            box-shadow: none;
        }
        .profile-button:hover { background: var(--blue-dark); color: #fff; }
        .profile-icon { width: 20px; height: 20px; margin-right: 5px; }
        .logout-menu {
            display: none;
            position: absolute;
            top: 55px;
            right: -5px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 249, 255, 0.9));
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0;
            backdrop-filter: blur(16px);
            z-index: 20;
            min-width: 180px;

        }
        .logout-menu.active { display: block; }
        .logout-link {
            width: 100%;
            display: block;
            background: transparent;
            color: #475569;
            border: none;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            text-decoration: none;
        }
        .logout-link.logout-link-danger {
            color: #e11d48;
        }
        .logout-link:hover {
            background: var(--blue-dark);
            color: #ffffff;
        }

        main { max-width: 1100px; margin: 40px auto 60px; padding: 0 24px; }

        h2 {
            font-size: 32px;
            margin-bottom: 12px;
            text-align: center;
            background: linear-gradient(135deg, #0f172a 0%, var(--blue-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        p.lead {
            color: #475569;
            margin: 0 auto 40px auto;
            line-height: 1.5;
            max-width: 760px;
            text-align: center;
            font-size: 14px;
        }

        .form-box {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.08);
            margin-bottom: 30px;
        }

        .form-box form {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 12px;
            align-items: center;
        }

        .form-box input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            font-size: 14px;
            background: #fff;
            color: #1e293b;
            transition: all 0.2s ease;
        }

        .form-box input:focus {
            outline: none;
            border-color: var(--blue-main);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.08);
        }

        button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 400;
            font-size: 13px;
            transition: all 0.2s ease;
            background: linear-gradient(135deg, var(--blue-dark), var(--blue-main));
            color: #fff;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.12);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.2);
        }

        .form-box button[type="submit"] {
            padding: 10px 28px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.92);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.08);
        }

        th, td { 
            padding: 12px 14px; 
            text-align: left; 
            font-size: 14px; 
            border-bottom: 1px solid rgba(148, 163, 184, 0.3); 
        }
        
        thead { background: #f8fafc; color: #0f172a; font-weight: 600; }
        tbody tr { background: #ffffff; }
        tbody tr:hover { background: rgba(37, 99, 235, 0.03); }

        th:nth-child(1) { width: 30%; }
        th:nth-child(2) { width: 60%; }
        th:nth-child(3) { width: 10%; }

        .action-column { display: none; }

        .delete-btn {
            background: #ef4444;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }

        .action-buttons {
            margin-top: 30px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .action-buttons button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            min-width: 130px;
            justify-content: center;
        }

        .btn-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .edit-column { 
            display: none;
            text-align: center;
        }

        .edit-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--blue-main);
            border-radius: 4px;
            font-size: 14px;
            background: #fff;
            color: #1e293b;
        }

        .edit-input:focus {
            outline: none;
            border-color: var(--blue-dark);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        .save-btn {
            background: transparent;
            color: #10b981;
            padding: 6px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: none;
        }

        .save-btn:hover {
            color: #059669;
            transform: scale(1.2);
            box-shadow: none;
        }

        .save-icon {
            width: 20px;
            height: 20px;
        }

        footer {
            background: linear-gradient(180deg, rgba(239, 246, 255, 0.6) 0%, rgba(248, 250, 252, 0.85) 30%, rgba(249, 250, 251, 1) 100%);
            border-top: 1px solid var(--glass-border);
            padding: 20px 24px;
            text-align: center;
            color: #64748b;
            font-size: 12px;
            margin-top: 60px;
        }

        .pagination-container {
            margin-top: 30px;
        }

        .pagination-info {
            margin-top: 0;
            text-align: right;
            font-size: 13px;
            color: #475569;
            margin-bottom: 15px;
        }

        .pagination-controls {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .pagination-controls a,
        .pagination-controls span {
            padding: 8px 12px;
            margin: 2px;
            text-decoration: none;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 13px;
            color: #475569;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .pagination-controls a:hover {
            background-color: var(--blue-main);
            color: white;
            border-color: var(--blue-main);
        }

        .pagination-controls .active {
            background-color: var(--blue-dark);
            color: white;
            border-color: var(--blue-dark);
        }

        .pagination-controls .disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
    </style>

    <script>
        let deleteMode = false;
        let editMode = false;
        let currentPage = 1;
        const itemsPerPage = 10;

        function toggleDeleteMode(button) {
            const actionCols = document.querySelectorAll('.action-column');

            if (!deleteMode) {
                actionCols.forEach(col => col.style.display = 'table-cell');
                button.innerHTML = '<svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line></svg>Valider';
                deleteMode = true;
            } else {
                actionCols.forEach(col => col.style.display = 'none');
                button.innerHTML = '<svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line></svg>Supprimer';
                deleteMode = false;
            }
        }

        function toggleEditMode(button) {
            const rows = document.querySelectorAll('tbody tr');
            if (!editMode) {
                rows.forEach(row => {
                    const nameCell = row.cells[0];
                    const descCell = row.cells[1];
                    const nameValue = nameCell.textContent;
                    const descValue = descCell.textContent;
                    nameCell.innerHTML = `<input type="text" class="edit-input" value="${nameValue}" data-original="${nameValue}">`;
                    descCell.innerHTML = `<input type="text" class="edit-input" value="${descValue}" data-original="${descValue}">`;
                });
                button.textContent = 'Valider';
                editMode = true;
            } else {
                let modification = false;
                rows.forEach(row => {
                    const nameInput = row.cells[0].querySelector('input');
                    const descInput = row.cells[1].querySelector('input');
                    const id = row.getAttribute('data-id');
                    if (nameInput && descInput && id) {
                        if (nameInput.value !== nameInput.dataset.original || descInput.value !== descInput.dataset.original) {
                            modification = true;
                            const form = document.createElement('form');
                            form.method = 'post';
                            form.action = `/categories/update/${id}`;
                            const nameField = document.createElement('input');
                            nameField.type = 'hidden';
                            nameField.name = 'name';
                            nameField.value = nameInput.value;
                            const descField = document.createElement('input');
                            descField.type = 'hidden';
                            descField.name = 'description';
                            descField.value = descInput.value;
                            form.appendChild(nameField);
                            form.appendChild(descField);
                            document.body.appendChild(form);
                            form.submit();
                        }
                    }
                });
                editMode = false;
                button.textContent = 'Modifier';
                if (modification) {
                    setTimeout(() => window.location.reload(), 300);
                }
            }
        }

        function saveCategory(categoryId, button) {
            const row = button.closest('tr');
            const nameInput = row.cells[0].querySelector('input');
            const descInput = row.cells[1].querySelector('input');
            

            const form = document.createElement('form');
            form.method = 'post';
            form.action = `/categories/update/${categoryId}`;
            
            const nameField = document.createElement('input');
            nameField.type = 'hidden';
            nameField.name = 'name';
            nameField.value = nameInput.value;
            
            const descField = document.createElement('input');
            descField.type = 'hidden';
            descField.name = 'description';
            descField.value = descInput.value;
            
            form.appendChild(nameField);
            form.appendChild(descField);
            document.body.appendChild(form);
            form.submit();
        }

        document.addEventListener('DOMContentLoaded', () => {
            const profileBtn = document.getElementById('profileBtn');
            const logoutMenu = document.getElementById('logoutMenu');
            profileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                logoutMenu.classList.toggle('active');
            });
            document.addEventListener('click', (e) => {
                if (!profileBtn.contains(e.target) && !logoutMenu.contains(e.target)) {
                    logoutMenu.classList.remove('active');
                }
            });


            updatePagination();
        });

        function updatePagination() {
            const rows = document.querySelectorAll('tbody tr');
            const totalItems = rows.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);


            rows.forEach((row, index) => {
                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                if (index >= start && index < end) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });


            const start = totalItems > 0 ? (currentPage - 1) * itemsPerPage + 1 : 0;
            const end = Math.min(currentPage * itemsPerPage, totalItems);
            
            const paginationInfo = document.getElementById('paginationInfo');
            if (paginationInfo) {
                paginationInfo.textContent = `${start}-${end}/${totalItems}`;
            }


            const paginationContainer = document.getElementById('paginationContainer');
            const paginationControls = document.getElementById('paginationControls');
            
            if (totalItems > itemsPerPage) {
                if (paginationContainer) paginationContainer.style.display = 'block';
                if (paginationControls) {
                    paginationControls.innerHTML = generatePaginationControls(totalPages);
                }
            } else {
                if (paginationControls) paginationControls.innerHTML = '';
            }
        }

        function generatePaginationControls(totalPages) {
            let html = '';


            if (totalPages > 2 && currentPage > 1) {
                html += `<a onclick="goToPage(1)">⏮ Première</a>`;
            }


            if (currentPage > 1) {
                html += `<a onclick="goToPage(${currentPage - 1})">◀ Précédent</a>`;
            }


            for (let i = 1; i <= totalPages; i++) {
                if (i >= currentPage - 2 && i <= currentPage + 2) {
                    const activeClass = i === currentPage ? 'active' : '';
                    html += `<span class="${activeClass}" onclick="goToPage(${i})">${i}</span>`;
                }
            }


            if (currentPage < totalPages) {
                html += `<a onclick="goToPage(${currentPage + 1})">Suivant ▶</a>`;
            }


            if (totalPages > 2 && currentPage < totalPages) {
                html += `<a onclick="goToPage(${totalPages})">Dernière ⏭</a>`;
            }

            return html;
        }

        function goToPage(page) {
            currentPage = page;
            updatePagination();
        }
    </script>
</head>
<body>

<header>
    <div class="logo"><span></span> FINEO</div>
    <nav>
        <a href="/budgets">Budgets</a>
        <a href="/expenses">Dépenses</a>
        <a href="/categories">Catégories</a>
        <a href="/reports">Rapports</a>
        <a href="/statistics">Statistiques</a>
    </nav>
    <div class="profile-menu">
        <button class="profile-button" id="profileBtn">
            <svg class="profile-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/>
            </svg>
        </button>
        <div class="logout-menu" id="logoutMenu">
            <a href="/users/profile" class="logout-link">Mon profil</a>
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="logout-link logout-link-danger">Se déconnecter</button>
            </form>
        </div>
    </div>
</header>


<main>
    <h2>Mes Catégories</h2>
    <p class="lead">Organisez vos dépenses par catégorie afin d'analyser facilement vos habitudes de consommation.</p>


    <div class="form-box">
        <form th:action="@{/categories/add}" method="post" th:object="${category}">
            <input th:field="*{name}" placeholder="Nom de la catégorie" required>
            <input th:field="*{description}" placeholder="Description">
            <button type="submit">Ajouter</button>
        </form>
    </div>


    <div class="action-buttons">
        <button type="button" onclick="toggleEditMode(this)">Modifier</button>
        <button type="button" onclick="toggleDeleteMode(this)">
            <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Supprimer
        </button>
    </div>


    <table>
        <thead>
            <tr>
                <th>Nom</th>
                <th>Description</th>
                <th class="action-column">Supprimer</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="cat : ${categories}" th:attr="data-id=${cat.id}">
                <td th:text="${cat.name}"></td>
                <td th:text="${cat.description}"></td>
                <td class="action-column">
                    <form th:action="@{'/categories/delete/' + ${cat.id}}" method="post" style="display: inline;">
                        <button type="submit" class="delete-btn">−</button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>


    <div id="paginationContainer" class="pagination-container">
        <p id="paginationInfo" class="pagination-info"></p>
        <div id="paginationControls" class="pagination-controls"></div>
    </div>
</main>


<footer>
    <p>&copy; 2025 FINEO . Tous droits réservés.</p>
</footer>

</body>
</html>